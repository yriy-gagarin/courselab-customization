<?xml version="1.0" encoding="UTF-8"?><!--
'*    nav_060_timer.xml
'*
--><params>
  <object>
    <format>2.0</format>
    <label>Таймер</label>
    <description>Таймер</description>
    <width>160</width>
    <height>40</height>
	<state_extension>false</state_extension>
  </object>
	<page name="Основные" w="320" h="160">

		<param type="check" id="start_onload" text="Автоматический запуск при загрузке модуля" def="yes" x="10" y="9" w="240" h="13"/>
		<param type="check" id="display_limit" text="Показывать лимит времени" def="yes" x="10" y="25" w="240" h="13"/>
		<param type="check" id="reverse_count" text="Показывать время обратным отсчетом" def="yes" x="10" y="41" w="240" h="13"/>
		<param type="label" id="lab_limit" text="Лимит времени" def="" x="10" y="58" w="120" h="13"/>
		<param type="spinner" id="limit_min" text="" def="45" x="130" y="56" w="32" h="13" min="0" max="9999"/>
		<param type="label" id="lab_limit_min" text="мин" def="" x="165" y="58" w="20" h="13"/>
		<param type="spinner" id="limit_sec" text="" def="0" x="190" y="56" w="32" h="13" min="0" max="59"/>
		<param type="label" id="lab_limit_sec" text="сек" def="" x="225" y="58" w="20" h="13"/>
		<param type="label" id="lab_text_timer" text="Текст таймера" def="" x="10" y="74" w="120" h="13"/>
		<param type="edit" id="text_timer" text="" def="Осталось" x="130" y="72" w="180" h="13"/>
		<param type="label" id="lab_text_limit" text="Текст лимита" def="" x="10" y="90" w="120" h="13"/>
		<param type="edit" id="text_limit" text="" def="Отведено" x="130" y="88" w="180" h="13"/>
		<param type="label" id="lab_units" text="Единицы времени" def="" x="10" y="106" w="120" h="13"/>
		<param type="edit" id="text_min" text="" def="мин" x="130" y="104" w="32" h="13"/>
		<param type="label" id="lab_text_min" text="мин" def="" x="165" y="106" w="22" h="13"/>
		<param type="edit" id="text_sec" text="" def="сек" x="190" y="104" w="32" h="13"/>
		<param type="label" id="lab_text_sec" text="сек" def="" x="225" y="106" w="24" h="13"/>
		<param type="label" id="lab_order" text="Режим показа" def="" x="10" y="122" w="120" h="13"/>
		<param type="select" id="order" text="" def="limit" x="130" y="120" w="180" h="13">
		  <items>
			<item id="limit" label="Лимит выше таймера"/>
			<item id="timer" label="Таймер выше лимита"/>
		  </items>
		</param>
	</page>
	<page name="Шрифт" w="320" h="160">

		<param type="line" id="LINE_font_1" text="" def="" x="5" y="10" w="310" h="94"/>
		<param type="line" id="LINE_font_2" text="" def="" x="5" y="26" w="310" h="78"/>
		<param type="label" id="lab_font" text="Шрифт" x="15" y="14" w="120" h="11"/>

		<param type="select" id="font" text="" def="robotoblack" x="15" y="34" w="113" h="13">
			<items>
				<item id="Arial" label="Arial">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="ArialBlack" label="Arial Black">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="ArialNarrow" label="Arial Narrow">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="ComicSansMS" label="Comic Sans MS">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="CourierNew" label="Courier New">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="Georgia" label="Georgia">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="Impact" label="Impact">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="LucidaConsole" label="Lucida Console">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="LucidaSansUnicode" label="Lucida Sans Unicode">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="Palatino" label="Palatino">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="Tahoma" label="Tahoma">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="Times" label="Times New Roman">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="TrebuchetMS" label="Trebuchet MS">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="Verdana" label="Verdana">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="clear_sans_lightregular" label="WF Clear Sans Light">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="clear_sans_mediumregular" label="WF Clear Sans Medium">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="clear_sansregular" label="WF Clear Sans Regular">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="clear_sans_thinregular" label="WF Clear Sans Thin">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="droid_sans_monoregular" label="WF Droid Sans Mono">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="droid_sansregular" label="WF Droid Sans Regular">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="droid_serifregular" label="WF Droid Serif Regular">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="Fira_Mono" label="WF Fira Mono">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="Fira_Sans" label="WF Fira Sans">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="FiraSansLight" label="WF Fira Sans Light">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="FiraSansMedium" label="WF Fira Sans Medium">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="Fregat_Sans" label="WF Fregat Sans">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="Lato_Sans" label="WF Lato Sans">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="LatoSansLight" label="WF Lato Sans Light">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="nerisblack" label="WF Neris Black">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="nerislight" label="WF Neris Light">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="nerissemibold" label="WF Neris SemiBold">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="neristhin" label="WF Neris Thin">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="noto_sansregular" label="WF Noto Sans Regular">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="noto_serifregular" label="WF Noto Serif Regular">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="open_sanscondensed_light" label="WF Open Sans Condensed Light">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="open_sansextrabold" label="WF Open Sans Extra Bold">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="open_sanslight" label="WF Open Sans Light">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="open_sansregular" label="WF Open Sans Regular">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="open_sanssemibold" label="WF Open Sans SemiBold">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="permiansanstypefaceregular" label="WF Permian Sans Regular">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="permianseriftypefaceregular" label="WF Permian Serif Regular">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="permianslabseriftypefaceRg" label="WF Permian Slab Serif Regular">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="robotoblack" label="WF Roboto Black">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="roboto_condensedregular" label="WF Roboto Condensed">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="roboto_condensedlight" label="WF Roboto Condensed Light">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="robotolight" label="WF Roboto Light">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="robotomedium" label="WF Roboto Medium">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="robotoregular" label="WF Roboto Regular">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="robotothin" label="WF Roboto Thin">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="roboto_slablight" label="WF Roboto Slab Light">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="roboto_slabregular" label="WF Roboto Slab Regular">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="roboto_slabthin" label="WF Roboto Slab Thin">
					<events>
						<event name="selendok" target="font_custom" action="disable"/>
					</events>
				</item>
				<item id="custom" label="По выбору">
					<events>
						<event name="selendok" target="font_custom" action="enable"/>
					</events>
				</item>
			</items>
		</param>
		<param type="edit" id="font_custom" text="" def="" x="130" y="34" w="175" h="13"/>

		<param type="label" id="lab_font_style" text="Стиль, размер" def="" x="15" y="50" w="115" h="11"/>
		<param type="select" id="font_style" text="" def="normal" x="130" y="48" w="118" h="13">
			<items>
				<item id="normal" label="Обычный"/>
				<item id="bold" label="Жирный"/>
				<item id="italic" label="Курсив"/>
				<item id="bolditalic" label="Курсив жирный"/>
			</items>
		</param>
		<param type="spinner" id="font_size" text="" def="11" x="250" y="48" w="32" h="13" min="1" max="100"/>
		<param type="label" id="lab_font_size2" text="пкс" x="285" y="50" w="25" h="11"/>

		<param type="label" id="lab_text_shadow_strength" text="Тень" def="" x="15" y="66" w="115" h="11"/>
		<param type="select" id="text_shadow_strength" text="" def="normal" x="130" y="64" w="118" h="13">
			<items>
				<item id="none" label="Без тени">
					<events>
						<event name="selendok" target="text_shadow_color" action="disable"/>
					</events>
				</item>
				<item id="extralight" label="Очень слабая">
					<events>
						<event name="selendok" target="text_shadow_color" action="enable"/>
					</events>
				</item>
				<item id="light" label="Слабая">
					<events>
						<event name="selendok" target="text_shadow_color" action="enable"/>
					</events>
				</item>
				<item id="normal" label="Нормальная">
					<events>
						<event name="selendok" target="text_shadow_color" action="enable"/>
					</events>
				</item>
				<item id="dark" label="Интенсивная">
					<events>
						<event name="selendok" target="text_shadow_color" action="enable"/>
					</events>
				</item>
				<item id="extradark" label="Очень интенсивная">
					<events>
						<event name="selendok" target="text_shadow_color" action="enable"/>
					</events>
				</item>
			</items>
		</param>
		<param type="color" id="text_shadow_color" text="" def="#FFFFFF" x="250" y="64" w="40" h="13"/>

		<param type="label" id="lab_font_color" text="Цвет" def="" x="15" y="82" w="115" h="11"/>
		<param type="color" id="timer_font_color" text="" def="#000000" x="130" y="80" w="40" h="13"/>
		<param type="color" id="limit_font_color" text="" def="#004080" x="190" y="80" w="40" h="13"/>

    </page>
    <methods>
		<method name="Constructor" label="_Constructor" access="private">
			<params>
			</params>
			<body>
			<![CDATA[function Constructor(argobj)
			{
				var oCurObj = CLO[argobj.pid];
				var iLimitMin = +oCurObj.jxParams.children("limit_min").text();
				var iLimitSec = +oCurObj.jxParams.children("limit_sec").text();
				if(isNaN(iLimitMin)) iLimitMin = 0;
				if(isNaN(iLimitSec)) iLimitSec = 0;
				var iTotalLimit = iLimitMin*60 + iLimitSec;
				oCurObj.data = { bDisplayLimit: (oCurObj.jxParams.find("display_limit").text()=="yes"), bReverse: (oCurObj.jxParams.find("reverse_count").text()=="yes"), iTotal: iTotalLimit, iLimitMin: iLimitMin, iLimitSec: iLimitSec, iTimer: 0 };
				if(oCurObj.data.bDisplayLimit)
				{
					var oLimit = CLTOOLS.FormatTime({ iValue: iTotalLimit });
					$(oCurObj.div).find(".cl-timer-limit-min").html(oLimit.sMin);
					$(oCurObj.div).find(".cl-timer-limit-sec").html(oLimit.sSec);
				}
				if(oCurObj.jxParams.children("start_onload").text()=="yes")
				{
					oCurObj.CallMethod({ sMethod: "Launch" });
				}
				return true;
			}]]>
			</body>
		</method>
		<method name="Start" label="ЗАПУСК" access="public">
			<params>
			</params>
			<body>
			<![CDATA[function Start(argobj)
			{
				if(CLO[argobj.pid]==null) return false;
				CLO[argobj.pid].CallMethod({ sMethod: "Launch" });
				return true;
			}]]>
			</body>
		</method>
		<method name="Launch" label="_Launch" access="private">
			<params>
			</params>
			<body>
			<![CDATA[function Launch(argobj)
			{
				var oCurObj = CLO[argobj.pid];
				if(oCurObj==null) return false;
				var iNow = (new Date()).valueOf();
				if(CL.Restore({ sId: argobj.pid, sProp: "id" })==null)
				{
					oCurObj.data.iTimestamp = iNow;
					oCurObj.data.iTimer = 0;
					oCurObj.data.bRunning = true;
					CL.Store({ sId: argobj.pid, sType: "other", iTimestamp: iNow, iElapsed: 0, iLatency: 0, iDuration: oCurObj.data.iTotal  });
					oCurObj.iTimerId = setTimeout(function () { oCurObj.CallMethod({ sMethod: "Tick" }); }, 1000);
					oCurObj.FireEvent({ sName: "onStart" });
				}
				else
				{
					var iElapsed = CL.Restore({ sId: argobj.pid, sProp: "elapsed" });
					if(iElapsed >= oCurObj.data.iTotal)
					{
						oCurObj.data.bRunning = false;
						oCurObj.FireEvent({ sName: "onTimeout" });
						return false;
					}
					else
					{
						oCurObj.data.iTimer = iElapsed;
						oCurObj.data.iTimestamp = iNow;
						oCurObj.data.bRunning = true;
						oCurObj.iTimerId = setTimeout(function () { oCurObj.CallMethod({ sMethod: "Tick" }); }, 1000);
						oCurObj.FireEvent({ sName: "onResume" });
					}
				}
				return true;
			}]]>
			</body>
		</method>
		<method name="Tick" label="_Tick" access="private">
			<params>
			</params>
			<body>
			<![CDATA[function Tick(argobj)
			{
				var oCurObj = CLO[argobj.pid];
				if(oCurObj==null) return false;
				var iNow = (new Date()).valueOf();
				if(CL.Restore({ sId: argobj.pid, sProp: "id" })!=null)
				{
					var iElapsed = CL.Restore({ sId: argobj.pid, sProp: "elapsed" });
					var iDifference = iNow - oCurObj.data.iTimestamp;
					iElapsed = iElapsed + Math.round(iDifference/1000);
					CL.Store({ sId: argobj.pid, iLatency: iElapsed, iElapsed: iElapsed });
					oCurObj.data.iTimestamp = iNow;
					oCurObj.data.iTimer = iElapsed;
					var iTimeToDisplay = (oCurObj.data.bReverse ? oCurObj.data.iTotal - oCurObj.data.iTimer : oCurObj.data.iTimer);
					var oTime = CLTOOLS.FormatTime({ iValue: iTimeToDisplay });
					$(oCurObj.div).find(".cl-timer-timer-min").html(oTime.sMin);
					$(oCurObj.div).find(".cl-timer-timer-sec").html(oTime.sSec);
					if(oCurObj.data.iTimer < oCurObj.data.iTotal)
					{
						oCurObj.data.bRunning = true;
						oCurObj.iTimerId = setTimeout(function () { oCurObj.CallMethod({ sMethod: "Tick" }); }, 1000);
						oCurObj.FireEvent({ sName: "onTick" });
					}
					else
					{
						oCurObj.data.bRunning = false;
						oCurObj.FireEvent({ sName: "onTimeout" });
					}
				}
				return true;
			}]]>
			</body>
		  </method>
        <method name="GetProperty" label="_GetProperty" access="private">
            <params>
            </params>
            <body>
            <![CDATA[function GetProperty(argobj)
            {
				var oCurObj = CLO[argobj.pid];
				if(oCurObj!=null)
				{
					switch(argobj.property.toLowerCase())
					{
						case "state":
						{
							return (oCurObj.data.bRunning ? "1" : "0");
						}
						case "value":
						{
							return oCurObj.data.iTimer;
						}
					}
				}
                return "";
            }]]>
            </body>
        </method>
    </methods>
</params>